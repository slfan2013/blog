<!DOCTYPE html>
<html>

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>METDA | Homepage</title>

    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="font-awesome/css/font-awesome.css" rel="stylesheet">

    <link href="css/animate.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
    <!--jsTree-->
    <link href="css/plugins/jsTree/style.min.css" rel="stylesheet">
        <!--ordering multiple select-->
    <link href="css/plugins/chosen/bootstrap-chosen.css" rel="stylesheet">

    <link href="css/local.css" rel="stylesheet">

    <link href="css/plugins/bootstrap-markdown/bootstrap-markdown.min.css" rel="stylesheet">

</head>

<body>

<div id="wrapper">


   <nav class="navbar-default navbar-static-side" role="navigation">
    <div class="sidebar-collapse">
        <ul class="nav metismenu" id="side-menu">
            <li style="background-color:#293846">
              <a href="landing_page.html"><span class="nav-label"><h2 style="margin-top:5px;margin-bottom:0px;">Met DA</h2></span></a>
            </li>

            <li class="active">
                <a href="index.html"><i class="fa fa-list-ul"></i> <span class="nav-label">Projects</span></a>
            </li>
            <li>
                <a href="#"><i class="fa fa-scissors"></i> <span class="nav-label">File manipulation</span><span class="fa arrow"></span></a>
                <ul class="nav nav-second-level collapse">
                    <li><a href="merging.html">merging</a></li>
                </ul>
            </li>
            <li>
                <a href="#"><i class="fa fa-scissors"></i> <span class="nav-label">Data Processing</span><span class="fa arrow"></span></a>
                <ul class="nav nav-second-level collapse">
                    <li><a href="data_transformation.html">data transformation</a></li>
                </ul>
            </li>
            <li>
                <a href="#"><i class="fa fa-superscript"></i> <span class="nav-label">Hypothesis Testing</span> <span class="fa arrow"></span></a>
                <ul class="nav nav-second-level collapse">
                    <li><a href="t_test.html">t-test</a></li>
                    <li><a href="nonparametric_t_test.html">nonparametric t-test</a></li>
                    <li><a href="paired_t_test.html">paired t-test</a></li>
                    <li><a href="nonparametric_paired_t_test.html">nonparametric paired t-test</a></li>
                </ul>
            </li>
            <li>
                <a href="#"><i class="fa fa-th-large"></i> <span class="nav-label">Descriptive Statistics</span> <span class="fa arrow"></span></a>
                <ul class="nav nav-second-level collapse">
                    <li><a href="fold_change.html">fold change</a></li>
                </ul>
            </li>
            <li>
                <a href="#"><i class="fa fa-bar-chart-o"></i> <span class="nav-label">Graphs</span><span class="fa arrow"></span></a>
                <ul class="nav nav-second-level collapse">
                    <li><a href="volcano plot.html">volcano plot</a></li>
                    <li><a href="two-way boxplot.html">two-way boxplot</a></li>
                </ul>
            </li>


            <li>
                <a href="#"><i class="fa fa-edit"></i> <span class="nav-label">Multivariate Analysis</span><span class="fa arrow"></span></a>
                <ul class="nav nav-second-level collapse">
                    <li><a href="pca.html">Principal Component Analysis</a></li>
                </ul>
            </li>
        </ul>

    </div>
</nav>

<div id="page-wrapper" class="white-bg">
<div class="row border-bottom">
        <nav class="navbar navbar-static-top" role="navigation" style="margin-bottom: 0;background-color: white">
        <div class="navbar-header">
            <a class="navbar-minimalize minimalize-styl-2 btn btn-primary " href="#"><i class="fa fa-bars"></i> </a>
            <p  id="selected_project_text" class="minimalize-styl-2"><i class="fa fa-bars"></i> <span class="m-r-sm text-muted welcome-message"> Project: <b id="selected_project_name"></b> is selected</span> </p>
            </div>
            <ul class="nav navbar-top-links navbar-right">
              <li><span class="m-r-sm text-muted welcome-message">Welcome to Met-DA! <!--<span id="username"></span>.--></span></li><li class="dropdown" id="topright_alert_parent">
                    <a class="dropdown-toggle count-info" href="#" id="topright_alert">
                        <i class="fa fa-bell"></i>  <span class="label label-primary"><span id="num_message"></span></span>
                    </a>
                    <ul class="dropdown-menu dropdown-alerts">
                        <li>
                            <a href="#">
                                <div>
                                    <i class="fa fa-envelope fa-fw"></i> You have 0 messages
                                    <span class="pull-right text-muted small">0 minutes ago</span>
                                </div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                          <div style="padding: 3px 20px;min-height: 0px;margin:4px">
                                    <i class="fa fa-save fa-fw"></i> Auto save
                                    <div class="switch pull-right">
                                        <div class="onoffswitch">
                                            <input type="checkbox" checked class="onoffswitch-checkbox" id="auto_save">
                                            <label class="onoffswitch-label" for="auto_save">
                                                <span class="onoffswitch-inner"></span>
                                                <span class="onoffswitch-switch"></span>
                                            </label>
                                        </div>
                                    </div>
                            </div>

                        </li>

                    </ul>
                </li>
              <!--<li><a href="login.html"><i class="fa fa-sign-out"></i> Log out</a></li>-->
            </ul>

        </nav>
        </div>

<div class='row' style="margin-top:5px">
  <div class="col-md-8">

  </div>
  <div class="col-md-4">

        <button class="btn btn-primary btn-sm pull-right" data-toggle="modal" data-target="#create_new_project_modal" style="margin-bottom: 5px;">New Project</button>
  </div>
</div>


<div class="row">
  <div class="col-md-9">
    <div id="viewTableTitle"></div>

    <div id="viewTable"></div>

  </div>
    <div class="col-md-3">


       <!-- Nav tabs --><div class="card">
                                    <ul class="nav nav-tabs" role="tablist">
                                        <li role="presentation" class="active"><a href="#project_structure" aria-controls="home" role="tab" data-toggle="tab">Structure</a></li>
                                        <li role="presentation"><a href="#project_information" aria-controls="profile" role="tab" data-toggle="tab">Information</a></li>
                                    </ul>

                                    <!-- Tab panes -->
                                    <div class="tab-content" style='min-height:500px'>
                                        <div role="tabpanel" class="tab-pane active" id="project_structure">
                                          <div id="jstree"></div>
                                        </div>
                                        <div role="tabpanel" class="tab-pane" id="project_information">
<h4>Project Description</h4>
<p id='project_description'><span style="color:#D3D3D3">Click me to add description</span></p>
<br />
<h4>Experimental Factor</h4>
<p id='experimental_factor'><span style="color:#D3D3D3">Click me to add experimental factor</span></p>


                                        </div>
                                    </div>
</div>


  </div>
</div>

<div class="modal inmodal animated" id="project_description_modal" tabindex="-1" role="dialog"  aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title">Edit project description</h4>
            </div>
            <div class="modal-body">
              <textarea class='form-control' id = "edit_project_description" rows="8" cols="40"></textarea>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id="project_description_edit_confirm">Yes</button>
                <button type="button" class="btn btn-white" data-dismiss="modal">Cancel</button>
            </div>

        </div>
    </div>
</div>

<div class="modal inmodal animated" id="experimental_factor_modal" tabindex="-1" role="dialog"  aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title">Edit experimental factor</h4>
                <p>You can pick at most two factors.</p>
            </div>
            <div class="modal-body">
                  <div class="form-group"><label class="col-sm-2 control-label">factors</label>
                      <div class="col-sm-10">
                        <select class="form-control m-b chosen-select" id="experimental_factor_option" multiple></select>
                      </div>
                  </div>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id="experimental_factor_edit_confirm">Yes</button>
                <button type="button" class="btn btn-white" data-dismiss="modal">Cancel</button>
            </div>

        </div>
    </div>
</div>






<button type="button" class="btn btn-xs btn-danger" id='delete_project' style="display:none"> delete project </button>
<button type="button" class="btn btn-xs btn-info" id='view_project_workflow' style="display:none"> project workflow </button>
<button type="button" class="btn btn-xs btn-primary" id='generate_report' style="display:none">generate report </button>



<div class="modal inmodal animated" id="delete_project_modal" tabindex="-1" role="dialog"  aria-hidden="true">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title">Are you sure?</h4>
            </div>
            <div class="modal-body"><p></p><p>If you delete it, you won't be able to recover it.</p></div>
            <div class="modal-footer">
                <button type="button" class="btn btn-white" id="delete_project_confirm">Yes</button>
                <button type="button" class="btn btn-primary" data-dismiss="modal">No</button>
            </div>
        </div>
    </div>
</div>





<button type="button" class="btn btn-default btn-xs" id='get_project_list'>get project list </button>



<!--delete file confirmation-->
<div class="modal inmodal animated shake" id="delete_node_modal" tabindex="-1" role="dialog"  aria-hidden="true">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title">Are you sure?</h4>
            </div>
            <div class="modal-body">If you delete it, you won't be able to recover it.</div>
            <div class="modal-footer">
                <button type="button" class="btn btn-white" id="confirm_delete_node">Yes</button>
                <button type="button" class="btn btn-primary" data-dismiss="modal">No</button>
            </div>
        </div>
    </div>
</div>

<!--edit file-->
<div class="modal inmodal fade" id="edit_file_modal" tabindex="-1" role="dialog"  aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title">Edit file</h4>
            </div>
            <div class="modal-body">
              <ul>
                <li>The file is automatically downloaded.</li>
                <li>Edit it in excel.</li>
                <li>Copy + paste the content into the following textarea.</li>
                <li>Preview is highly recommanded before submit!</li>
              </ul>
              <textarea class='form-control' placeholder ="Paste your data here.." id="edit_file_input" rows="10"></textarea>
              <button type="button" class="btn btn-w-m btn-warning btn-sm" style="margin-top:5px" id="preview_edit_file_button">preview</button>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id="confirm_edit_file_node">Submit</button>
                <button type="button" class="btn btn-white" data-dismiss="modal">Cancel</button>
            </div>
        </div>
    </div>
</div>




<div class="modal" id="create_new_project_modal" tabindex="-1">
                                <div class="modal-dialog">
                                    <div class="modal-content animated zoomIn" style="animation-duration: .5s;">
                                        <div class="modal-header">
                                            <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                                            <h4 class="modal-title">Creat a New Projects</h4>
                                            </div>
                                        <div class="modal-body">
                                            <form role="form" id="create_new_project_form">
                                              <div class="form-group"><label>Project Name</label> <input placeholder="" class="form-control" id="new_project_name" required="" autofocus></div>
                                              <div>
                                              </div>
                                              <div class="form-group"><label>Upload Sample Info</label>
                                              <input type="file" id="upload_phenotype_data" accept=".csv" required="">
                                              </div>
                                              <div class="form-group"><label>Upload Metabolite Info</label>
                                              <input type="file" id="upload_feature_data" accept=".csv" required="">
                                              </div>
                                              <div class="form-group"><label>Upload Expression Data</label>
                                              <input type="file" id="upload_expression_data" accept=".csv" required=""><br /><a href="#">Example</a>
                                              <button type="submits" class="btn btn-primary pull-right">create</button>
                                              </div>
                                           </form>

                                        </div>
                                    </div>
                                </div>
</div>


<div id="project_list">
    <ol class="tabs"></ol>
</div>


</div>




</div>

<!-- Mainly scripts -->
<script src="js/jquery-3.1.1.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/plugins/metisMenu/jquery.metisMenu.js"></script>
<script src="js/plugins/slimscroll/jquery.slimscroll.min.js"></script>

<!-- Custom and plugin javascript -->
<script src="js/inspinia.js"></script>
<script src="js/plugins/pace/pace.min.js"></script>
<!--jsTree-->
<script src="js/plugins/jsTree/jstree.min.js"></script>
<!--CHOSEN
<script src="js/plugins/chosen/chosen.jquery.js"></script>-->
<script src="js/chosen.jquery.min.js"></script>
<script src="js/chosen.order.jquery.min.js"></script>
<script src="js/jQuery_extention.js"></script>

<script src="js/opencpu-0.5.js"></script>

<script src="js/pouchdb.min.js"></script>

<script src="http://127.0.0.1:5984/_utils/script/jquery.couch.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/limonte-sweetalert2/6.11.4/sweetalert2.all.min.js"></script>

<script src="js/local-tree-related.js"></script>

<!-- Bootstrap markdown -->
<script src="js/plugins/bootstrap-markdown/bootstrap-markdown.js"></script>
<script src="js/plugins/bootstrap-markdown/markdown.js"></script>



<script>
  $(function(){


// make table with pure javascript.
   makeProjectListTableHTML = function(myArray) {

     var project_id = localStorage.getItem('project_id_global')
     if(project_id===null){
       project_id = ""
     }

			var headers = Object.keys(myArray[0])
			var result = "<table class='table table-hover animated fadeInUp' style='font-size:medium'><thead>";
			// headers
			for(var h=0; h<headers.length;h++){
				result = result + "<th>"+ headers[h] + "</th>";
			}
			result = result+"</thead><tbody>"

			for(var i=0; i<myArray.length; i++) {
				result += "<tr>";
  			for(var j=0; j<headers.length; j++){
  			  if(j==0){
  			    if(myArray[i][headers[j]] === project_id.split("_68410298_")[0]){
              result +=  "<td id='first_td_"+i+"' class='text-navy'>"+myArray[i][headers[j]]+"</td>";
  			    }else{
  			      result +=  "<td id='first_td_"+i+"'>"+myArray[i][headers[j]]+"</td>";
  			    }

  			  }else{
  			    result += "<td>"+myArray[i][headers[j]]+"</td>";
  			  }
  			}
				result += "</tr>";
			}
			result += "</tbody></table>";
      return result;
      }


var db_user_info = new PouchDB('http://slfan:Fansly68410298_@localhost:5984/abib_user_info');
var db = new PouchDB('http://slfan:Fansly68410298_@localhost:5984/abib');

      db.allDocs().then(function(result){

        db_user_info.get(localStorage.getItem("username")).then(function(doc){
          project_id = doc.project_list

          if(project_id.length === 0){
            $("#viewTableTitle").html("<div class='text-center css-animation-box animated fadeInLeft'><h1 class='text-navy animated fadeInLeft'>Let's create a new project</h1><h4>It seems that you don't have any project yet. Let's create one!</h4><button class='btn btn-primary btn-sm'  data-toggle='modal' data-target='#create_new_project_modal' style='margin-bottom: 5px;'> Create a new project</button></div>")
          }else{
            $("#viewTableTitle").html("<div class='text-center css-animation-box animated fadeInLeft'><h1 class='text-navy animated fadeInLeft'>Project List</h1><p>Click project name to change activated project. You can always track which project is activated at the topleft of the page.</p></div>")
          }

          return(project_id)
        }).then(function(project_id){
              var dta = []
              for(var j=0;j<project_id.length;j++){
                  for(var i=0;i<result.rows.length;i++){
                    //if(project_id.indexOf(result.rows[i].id) > -1){
                    if(project_id[j] === result.rows[i].id){
                        dta.push({
                          "Project Name":result.rows[i].id.split("_68410298_")[0],
                          "Updated":result.rows[i].key,
                          "Size":result.rows[i].value.rev
                        })
                    }
                  }
              }

              $("#viewTable").html(makeProjectListTableHTML(dta))
              $('#viewTable').find('tr').click( function(){


               $("#delete_project").removeAttr("style")
               $("#view_project_workflow").removeAttr("style")
               $("#generate_report").removeAttr("style")




               $("#first_td_"+$(this).index()).addClass("text-navy")
               for(var index=0; index<1000;index++){
                 if(index!==$(this).index()){
                   $("#first_td_"+index).removeClass("text-navy")
                 }
               }



               $("#selected_project_name").text(project_id[($(this).index())].split("_68410298_")[0])

               localStorage.setItem('project_id_global', project_id[($(this).index())])

               load_tree(localStorage.getItem('project_id_global'))
               if(localStorage.getItem('project_id_global') === null){
                  $("#selected_project_text").hide()
                }else{
                  $("#selected_project_text").show()
                  $("#selected_project_name").text(localStorage.getItem('project_id_global').split("_68410298_")[0])
                }

                var db = new PouchDB('http://slfan:Fansly68410298_@localhost:5984/abib');
                  db.get(localStorage.getItem("project_id_global"), {attachments: true}).then(function(doc){
                  $("#project_description").html(doc.project_description)
                  if(doc.experimental_factor!==undefined){
                    $("#experimental_factor").html(doc.experimental_factor.join())
                  }else{
                    $("#experimental_factor").html('<span style="color:#D3D3D3">Click me to add experimental factor</span>')
                  }

                })

              });
        })


      }).catch(function (err) {
        console.log(err);
      });


$("#delete_project").click(function(){
  $('#delete_project_modal').modal('show');
})
$("#view_project_workflow").click(function(){

  var req = ocpu.call("view_project_workflow",{
    project_ID:localStorage.getItem("project_id_global"),
  },function(session){
    window.open(session.loc + "files/workflow.html");
  })



})
$("#delete_project_confirm").click(function(){ // when delete project, remove the project id from the user_info. add a "deleted"" to the project.
  var db = new PouchDB('http://slfan:Fansly68410298_@localhost:5984/abib');
  var db_user_info = new PouchDB('http://slfan:Fansly68410298_@localhost:5984/abib_user_info');

  db_user_info.get(localStorage.getItem("username")).then(function(doc_user_info){
    doc_user_info.project_list.splice(doc_user_info.project_list.indexOf(localStorage.getItem('project_id_global')))
    db_user_info.put(doc_user_info)
  }).then(function(){
    db.get(localStorage.getItem('project_id_global')).then(function(doc){
      var d = new Date()
      doc.deleted = "deleted at "+ d
      return(doc)
    }).then(function(doc){
      db.put(doc);
      localStorage.removeItem('project_id_global')
      location.reload();
    })
  }).catch(function (err) {
        console.log(err);
  });

})


$("#create_new_project_form").submit(function(event){
  event.preventDefault()
  var db = new PouchDB('http://slfan:Fansly68410298_@localhost:5984/abib');
  var db_user_info = new PouchDB('http://slfan:Fansly68410298_@localhost:5984/abib_user_info');

  db_user_info.get(localStorage.getItem("username")).then(function(doc){
    project_list = doc.project_list
    return(project_list)
  }).then(function(project_list){
  var project_name = [];
  for(i = 0; i < project_list.length; i++){
    project_name.push(project_list[i].split("_68410298_")[0])
  }

  if(project_name.indexOf($("#new_project_name").val()) > -1){
    alert("Project name: " + $("#new_project_name").val() + " is taken!")
  }else{
 // check format using R.
  var req = ocpu.call("check_data_format",{
    phenotype_data:$("#upload_phenotype_data")[0].files[0],
    feature_data:$("#upload_feature_data")[0].files[0],
    expression_data:$("#upload_expression_data")[0].files[0]
  },function(session){
    session.getObject(function(obj){
      if(obj.success){
        var d = new Date();
        var num_date = d.getTime();
        var project_id = $("#new_project_name").val()+"_68410298_"+num_date;
        // use pouchdb to create project, upload files and create tree structure.
        // put new project to couchdb, attach upload files, create tree structure, push to project_list, finish.
        var new_project = {
          "_id":project_id,
          "created_time":d,
          "tree_structure":[
            {"id":"root","parent":"#","text":$("#new_project_name").val(),icon:"fa fa-folder", report:"Project: " + $("#new_project_name").val()+" report\n============\nthis is a paragraph."},
            {"id":"expression_data_68410298_"+num_date+"_csv","parent":"root","text":"expression_data.csv",icon:"fa fa-file-excel-o",attname:"expression_data_68410298_"+num_date+".csv",source:{FUNCTION:"check_data_format", PARAMETER:{
    phenotype_data:file_to_jsonable_object($("#upload_phenotype_data")[0].files[0]),
    feature_data:file_to_jsonable_object($("#upload_feature_data")[0].files[0]),
    expression_data:file_to_jsonable_object($("#upload_expression_data")[0].files[0])
  }}, source_node_id: "root"},
            {"id":"metabolite_info_68410298_"+num_date+"_csv","parent":"root","text":"metabolite_info.csv",icon:"fa fa-file-excel-o",attname:"metabolite_info_68410298_"+num_date+".csv",source:{FUNCTION:"check_data_format", PARAMETER:{
    phenotype_data:file_to_jsonable_object($("#upload_phenotype_data")[0].files[0]),
    feature_data:file_to_jsonable_object($("#upload_feature_data")[0].files[0]),
    expression_data:file_to_jsonable_object($("#upload_expression_data")[0].files[0])
  }}, source_node_id: "root"},
            {"id":"sample_info_68410298_"+num_date+"_csv","parent":"root","text":"sample_info.csv",icon:"fa fa-file-excel-o",attname:"sample_info_68410298_"+num_date+".csv",source:{FUNCTION:"check_data_format", PARAMETER:{
    phenotype_data:file_to_jsonable_object($("#upload_phenotype_data")[0].files[0]),
    feature_data:file_to_jsonable_object($("#upload_feature_data")[0].files[0]),
    expression_data:file_to_jsonable_object($("#upload_expression_data")[0].files[0])
  }}, source_node_id: "root"}
          ],
          "sample_info_column_name":obj.sample_info_column_name,
          "sample_info":obj.sample_info,
          "sample_info_length":obj.sample_info_length,
          "sample_info_class":obj.sample_info_class,



          "compound_info_column_name":obj.compound_info_column_name,
          "compound_info":obj.compound_info,
          "compound_info_length":obj.compound_info_length,
          "compound_info_class":obj.compound_info_class
        }



        db.put(new_project).then(function(){

          db.get(project_id, {attachments: true}).then(function(db_doc){
            if(typeof db_doc['_attachments'] == 'undefined'){
              db_doc['_attachments'] = {}
            }
            db_doc['_attachments']["expression_data"+"_68410298_"+num_date+".csv"] = {
              content_type:$("#upload_expression_data")[0].files[0].type,
              "data": $("#upload_expression_data")[0].files[0]
            }
            db_doc['_attachments']["metabolite_info"+"_68410298_"+num_date+".csv"] = {
              content_type:$("#upload_feature_data")[0].files[0].type,
              "data": $("#upload_feature_data")[0].files[0]
            }
            db_doc['_attachments']["sample_info"+"_68410298_"+num_date+".csv"] = {
              content_type:$("#upload_phenotype_data")[0].files[0].type,
              "data": $("#upload_phenotype_data")[0].files[0]
            }
            return db_doc;



          }).then(function(db_doc){
            db.put(db_doc);
            return db_user_info.get(localStorage.getItem("username"));
          }).then(function(db_user_info_doc){

             db_user_info_doc.project_list.push(project_id);
             db_user_info.put(db_user_info_doc)
             $('#create_new_project_modal').modal('hide');
             localStorage.setItem("project_id_global", project_id)
             location.reload();
          })
        }).catch(function (err) {
          alert(err);
        });
      }
    })
  })

  }
  })





});


// report related
$("#generate_report").click(function(){

  var req = ocpu.call("generate_report_text",{
    project_ID:localStorage.getItem("project_id_global")
  },function(session){
    sss = session
    session.getObject(function(obj){
      localStorage.setItem("report_text",obj[0])

      window.location.href = "report_generator.html";

    })
  })

})




})
</script>

<script>

$(function () {



 $(document).on('dnd_move.vakata', function (e, data) {
    ooo = data
 });


$("#jstree").on('move_node.jstree', function (e, data) {
  return(false)
});



   });

 </script>



</body>

</html>
